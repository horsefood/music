class HighLight{constructor(t,e,o,s){this._mode="NONE",this._callback=null,this._div_overlays=new Array,this._target=t,this._renderers=e,this._score=o,this._options=s,this._pre_bgcolor=null,this._pre_opacity=null,this._is_piano=null}activeMode(t,e,o){this._mode=t,this._initialize(),"SELECT"==this._mode?this._mode_select(e,o):"NEW"==this._mode&&this._mode_new(e,o)}_initialize(){for(;this._div_overlays.firstChild;)this._div_overlays.removeChild(this._div_overlays.firstChild);for(let t=0;t<this._score.length;t++){this._div_overlays[t]=document.createElement("div"),this._div_overlays[t].style.visibility="hidden";for(let e in this._score[t])for(let o in this._score[t][e].staves){const s=document.createElement("div");s.id="hl-"+t+"-"+e+"-"+o+"-none",s.style.position="absolute",this._options.combineparts?(s.style.left=this._score[t][e].staves[o].x*this._options.ratio.w+this._renderers[0].element.offsetLeft+"px",s.style.top=this._score[t][e].staves[o].y*this._options.ratio.h+this._renderers[0].element.offsetTop+"px"):(s.style.left=this._score[t][e].staves[o].x*this._options.ratio.w+this._renderers[t].element.offsetLeft+"px",s.style.top=this._score[t][e].staves[o].y*this._options.ratio.h+this._renderers[t].element.offsetTop+"px"),s.style.width=this._score[t][e].staves[o].width*this._options.ratio.w+"px",s.style.height=this._score[t][e].staves[o].height*this._options.ratio.h+"px",s.style.zIndex="777",this._div_overlays[t].appendChild(s)}this._target.appendChild(this._div_overlays[t])}if(this._options.combineparts)for(let t=0;t<this._score.length;t++)this._div_overlays[t].style.visibility="visible";else this._div_overlays[0].style.visibility="visible"}_mode_select(t,e){if("SELECT"!=this._mode)return;const o=this._options.hlcolor;for(let s in t)for(let i in t[s]){const l="hl-"+t[s][i]+"-none",r=document.getElementById(l);null!=r&&(r.id="hl-"+t[s][i]+"-set",r.style.backgroundColor=o.color,r.style.opacity=o.opacity,r.addEventListener("mouseover",(function(t){t.target.style.cursor="pointer";const e=t.target.id.split("-");"set"==e[e.length-1]?(t.target.style.backgroundColor=o.mouseovercolor,t.target.style.opacity=o.mouseoveropacity):"focus"==e[e.length-1]&&(t.target.style.backgroundColor=o.focusmouseovercolor,t.target.style.opacity=o.focusmouseoveropacity)}),!1),r.addEventListener("mouseout",(function(t){t.target.style.cursor="default";const e=t.target.id.split("-");"set"==e[e.length-1]?(t.target.style.backgroundColor=o.color,t.target.style.opacity=o.opacity):"focus"==e[e.length-1]&&(t.target.style.backgroundColor=o.focuscolor,t.target.style.opacity=o.focusopacity)}),!1),r.addEventListener("mousedown",(function(t){const o=t.target.id.split("-");e(o[1]+"-"+o[2]+"-"+o[3])}),!1))}}_mode_new(t,e){function o(t,e){let o="";for(let s=0;s<t.length;s++)s+1==t.length?o+=e:o+=t[s]+"-";return o}if("NEW"!=this._mode)return;const s=this._options.newhlcolor,i=new Array,l=new Array,r=new Array;this._pre_bgcolor=i,this._pre_opacity=l,this._is_piano=r;let n=null;for(let e in t)for(let o in t[e]){const s="hl-"+t[e][o]+"-none",i=document.getElementById(s);null!=i&&(i.style.backgroundColor=this._options.hlcolor.color,i.style.opacity=this._options.hlcolor.opacity)}for(let t in this._div_overlays){i[t]=new Array,l[t]=new Array,1==this._score[t][0].staves.length?r[t]=!1:r[t]=!0;for(let c=0;c<this._div_overlays[t].childNodes.length;c++){const a=this._div_overlays[t].childNodes.item(c);i[t][c]=a.style.backgroundColor,l[t][c]=a.style.opacity,a.addEventListener("mouseover",(function(t){const e=t.target.id.split("-");"none"==e[e.length-1]?(t.target.style.cursor="pointer",t.target.style.backgroundColor=s.mouseovercolor,t.target.style.opacity=s.mouseoveropacity):t.target.style.cursor="default"}),!1),a.addEventListener("mouseout",(function(t){const e=t.target.id.split("-");if("none"==e[e.length-1]){t.target.style.cursor="default";const o=Number(e[1]),s=Number(e[2]),n=Number(e[3]);r[o]?(t.target.style.backgroundColor=i[o][2*s+n],t.target.style.opacity=l[o][2*s+n]):(t.target.style.backgroundColor=i[o][s],t.target.style.opacity=l[o][s])}}),!1),a.addEventListener("mousedown",(function(t){const i=t.target.id.split("-");if(null==n)"none"==i[i.length-1]&&(t.target.style.backgroundColor=s.pickfirstcolor,t.target.style.opacity=s.pickfirstopacity,this.id=o(i,"slcted"),n=this.id);else{const o=n.split("-"),i=t.target.id.split("-");if(Number(o[2])<=Number(i[2])){const l=new Array,r={s:Number(o[1]),e:Number(i[1])},c={s:Number(o[2]),e:Number(i[2])};for(let t=r.s;t<=r.e;t++)for(let e=c.s;e<=c.e;e++){let r=Number(o[3]);do{const o="hl-"+t+"-"+e+"-"+r+"-slcted";let i=document.getElementById(o);null==i&&(i=document.getElementById("hl-"+t+"-"+e+"-"+r+"-none")),null!=i&&(i.id=o,i.style.backgroundColor=s.picksecondcolor,i.style.opacity=s.picksecondopacity,l.push(t+"-"+e+"-"+r)),r++}while(r<=Number(i[3]))}0<l.length&&(t.target.style.cursor="default",n=null,e(l))}}}),!1)}}}focusHl(t){if("SELECT"!=this._mode)return;const e=this._options.hlcolor;for(let t in this._div_overlays)for(let o=0;o<this._div_overlays[t].childNodes.length;o++){const s=this._div_overlays[t].childNodes.item(o),i=s.id.split("-");"set"!=i[4]&&"focus"!=i[4]||(s.id=i[0]+"-"+i[1]+"-"+i[2]+"-"+i[3]+"-set",s.style.backgroundColor=e.color,s.style.opacity=e.opacity)}for(let o in t){const s="hl-"+t[o]+"-set",i=document.getElementById(s);if(null!=i){const t=i.id.split("-");i.id=t[0]+"-"+t[1]+"-"+t[2]+"-"+t[3]+"-focus",i.style.backgroundColor=e.focuscolor,i.style.opacity=e.focusopacity}}}clearHl(){if("NEW"==this._mode)for(let t in this._div_overlays)for(let e=0;e<this._div_overlays[t].childNodes.length;e++){const o=this._div_overlays[t].childNodes.item(e),s=o.id.split("-");o.id=s[0]+"-"+s[1]+"-"+s[2]+"-"+s[3]+"-none",o.style.cursor="default";const i=Number(s[1]),l=Number(s[2]),r=Number(s[3]);this._is_piano[i]?(o.style.backgroundColor=this._pre_bgcolor[i][2*l+r],o.style.opacity=this._pre_opacity[i][2*l+r]):(o.style.backgroundColor=this._pre_bgcolor[i][l],o.style.opacity=this._pre_opacity[i][l])}}getAllHl(){if("NEW"!=this._mode)return;const t=new Array;for(let e in this._div_overlays)for(let o=0;o<this._div_overlays[e].childNodes.length;o++){const s=this._div_overlays[e].childNodes.item(o).id.split("-");"slcted"==s[s.length-1]&&t.push(s[1]+"-"+s[2]+"-"+s[3])}return t}getY(t){const e=t.split("-");return this._score[e[0]][e[1]].top[e[2]]}}